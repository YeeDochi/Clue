<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>game-hub/Clue</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="https://cdn.simpleicons.org/github/ffffff" type="image/svg+xml">
    <style>
        /* [1] ê²Œì„ ë ˆì´ì•„ì›ƒ (style.cssì˜ ë³€ìˆ˜ í™œìš©) */
        .game-layout {
            display: flex; gap: 20px; width: 100%; height: auto; min-height: 850px; padding-bottom: 20px;
        }
        .game-stage {
            flex: 0 0 600px;
            border: 1px solid var(--border-color);
            background: #2b2b2b; /* ê²Œì„íŒ ë°°ê²½ì€ ì–´ë‘¡ê²Œ ìœ ì§€ */
            border-radius: 8px;
            overflow: hidden;
            display: flex; flex-direction: column; align-items: center; padding: 20px;
        }

        /* [2] ë³´ë“œíŒ & íƒ€ì¼ (ê²Œì„ ê³ ìœ  ìŠ¤íƒ€ì¼) */
        .clue-board-grid {
            display: grid; grid-template-columns: repeat(22, 1fr); grid-template-rows: repeat(22, 1fr);
            gap: 0; aspect-ratio: 1 / 1; width: 100%; max-width: 560px;
            background: #3a3a3a; border: 8px solid #4a3b2a;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5); box-sizing: content-box;
        }
        .tile { position: relative; background: #e3c099; outline: 1px solid rgba(0,0,0,0.05); cursor: pointer; aspect-ratio: 1 / 1; display: flex; justify-content: center; align-items: center; }
        .tile:hover { filter: brightness(0.9); z-index: 2; outline: 1px solid var(--link-color); }
        .tile.wall { background: transparent; pointer-events: none; outline: none; }
        .tile.room-area { background-color: #f4f4f4; opacity: 0.95; outline: none; cursor: default; }
        .tile.door { background: #e3c099; box-shadow: inset 0 0 0 2px #b8860b; z-index: 1; }
        .tile.door i { font-weight: 900; color: #5a3a22; }
        .tile.start-pos { background: #ffcccc; box-shadow: inset 0 0 5px rgba(255,0,0,0.2); }

        .token { width: 70%; height: 70%; border-radius: 50%; border: 2px solid white; position: absolute; top: 15%; left: 15%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 10px; z-index: 10; box-shadow: 1px 2px 4px rgba(0,0,0,0.6); }
        .room-label-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); white-space: nowrap; font-weight: 800; font-size: 18px; color: #222; text-transform: uppercase; text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff; pointer-events: none; z-index: 5; opacity: 0.8; }

        /* [3] ìš°ì¸¡ íŒ¨ë„ & ë¡œê·¸ */
        .right-panel { flex: 1; display: flex; flex-direction: column; gap: 10px; min-width: 300px; max-height: 800px; }
        .panel-box {
            flex: 1; display: flex; flex-direction: column; overflow: hidden;
            /* style.cssì˜ .box ìŠ¤íƒ€ì¼ ìƒì† ëŒ€ì‹  ì§ì ‘ ì§€ì •í•˜ê±°ë‚˜ class="box panel-box"ë¡œ ì‚¬ìš© */
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--box-bg);
            color: var(--text-primary);
        }
        .panel-header {
            padding: 10px 15px; background: var(--bg-header); border-bottom: 1px solid var(--border-color);
            font-size: 14px; font-weight: 600; color: var(--text-primary);
        }
        .scroll-content { flex: 1; overflow-y: auto; padding: 12px; font-size: 13px; color: var(--text-primary); line-height: 1.5; }
        #game-logs { background: rgba(0,0,0,0.02); }
        .log-item { margin-bottom: 8px; border-bottom: 1px dashed var(--border-color); padding-bottom: 4px; }

        .chat-input-area {
            padding: 10px; border-top: 1px solid var(--border-color);
            display: flex; gap: 8px; align-items: center;
            background: var(--bg-header);
        }

        /* [4] ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .my-hand-area { width: 95%; height: 140px; margin-top: 15px; background: rgba(0,0,0,0.1); border-radius: 8px; padding: 10px; display: flex; gap: 10px; overflow-x: auto; align-items: center; border: 1px solid rgba(255,255,255,0.2); }
        .clue-card {
            min-width: 85px; height: 120px; border-radius: 8px; display: flex; flex-direction: column; overflow: hidden;
            box-shadow: 2px 4px 8px rgba(0,0,0,0.3); user-select: none; transition: transform 0.2s;
            background: #fff; flex-shrink: 0; border: 2px solid #ccc;
        }
        .clue-card:hover { transform: translateY(-10px) scale(1.05); z-index: 10; cursor: pointer; }
        .card-type { font-size: 10px; font-weight: 800; text-transform: uppercase; padding: 4px 0; text-align: center; color: white; letter-spacing: 1px; width: 100%; }
        .card-body { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 5px; background: linear-gradient(180deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.2) 100%); }
        .card-icon { font-size: 32px; margin-bottom: 5px; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2)); }
        .card-name { font-weight: 700; font-size: 12px; text-align: center; color: #333; word-break: keep-all; }

        .clue-card.suspect { border-color: #c0392b; background-color: #ffcccc; } .clue-card.suspect .card-type { background-color: #c0392b; }
        .clue-card.weapon { border-color: #34495e; background-color: #d6dbdf; } .clue-card.weapon .card-type { background-color: #34495e; }
        .clue-card.room { border-color: #d35400; background-color: #fce6c9; } .clue-card.room .card-type { background-color: #d35400; }

        .refute-option { width: 90px; height: 130px; margin: 0 5px; }
        .disabled-card { opacity: 0.6; filter: grayscale(80%); border-color: #aaa !important; background-color: #eee !important; pointer-events: none; }
        .disabled-card .card-type { background-color: #777 !important; }

        /* [5] ëª¨ë‹¬ & íƒì • ìˆ˜ì²© (style.css ë³€ìˆ˜ ì ìš©) */
        .modal-body { padding: 20px; color: var(--text-primary); }
        .select-group { margin-bottom: 15px; }
        .select-group label { display: block; font-weight: bold; margin-bottom: 6px; font-size: 13px; color: var(--text-primary); }

        /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ ê°•ì œ ì§€ì • í•´ì œ (ë³€ìˆ˜ ì‚¬ìš©) */
        #alert-msg-text, #confirm-msg-text, #result-msg, #refute-msg { color: var(--text-primary); }

        /* [íƒì • ìˆ˜ì²© í•µì‹¬ ìˆ˜ì •] style.cssì˜ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤í¬ëª¨ë“œ ìë™ ëŒ€ì‘ */
        .notebook-panel-style {
            position: fixed; top: 50px; right: 20px;
            width: 340px; height: 80vh;
            background: var(--box-bg);       /* ë°°ê²½: í…Œë§ˆì— ë”°ë¦„ */
            border: 2px solid var(--text-primary); /* í…Œë‘ë¦¬: í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            color: var(--text-primary);      /* ê¸€ì: í…Œë§ˆì— ë”°ë¦„ */
            z-index: 1800; border-radius: 8px;
            display: flex; flex-direction: column;
            box-shadow: -5px 5px 20px rgba(0,0,0,0.5);
        }
        .notebook-body {
            flex: 1; overflow-y: auto; padding: 10px;
            background: var(--bg-body); /* ì†ì§€ ë°°ê²½: í…Œë§ˆì— ë”°ë¦„ */
        }
        .notebook-footer {
            padding: 10px;
            background: var(--bg-header);
            border-top: 1px solid var(--border-color);
        }
        .close-btn { background: none; border: none; color: var(--text-primary); cursor: pointer; font-size: 16px; font-weight: bold; }

        /* ìˆ˜ì²© ë‚´ë¶€ í…Œì´ë¸” ì¬ì •ì˜ */
        #notebook-table th, #notebook-table td {
            border: 1px solid var(--border-color);
            text-align: center; padding: 4px 2px;
            cursor: pointer; user-select: none;
            color: var(--text-primary);
        }
        #notebook-table th {
            background: var(--bg-header);
            position: sticky; top: 0; font-weight: bold;
        }

        /* ì„¹ì…˜ êµ¬ë¶„ (ì¸ë¬¼/ì¥ì†Œ ë“±) - í•­ìƒ ì–´ë‘¡ê²Œ ìœ ì§€ */
        .section-row {
            background: #333 !important; color: #fff !important;
            font-weight: bold; text-align: left !important; padding-left: 10px !important;
            pointer-events: none;
        }

        /* ì²´í¬ í‘œì‹œ ìƒ‰ìƒ */
        .cell-x { color: #d73a49; font-weight: bold; background: rgba(215, 58, 73, 0.1); }
        .cell-o { color: #2da44e; font-weight: bold; background: rgba(45, 164, 78, 0.1); }
        .cell-q { color: #d29922; font-weight: bold; }

        /* [6] ë‹¤í¬ëª¨ë“œ ì‹œ ê²Œì„ ìš”ì†Œ ì˜¤ë²„ë¼ì´ë“œ (style.cssê°€ ì»¤ë²„ ëª»í•˜ëŠ” ë¶€ë¶„) */
        body.dark-mode .game-stage { background: #1a1a1a; border-color: #333; }
        body.dark-mode .clue-board-grid { background: #111; border-color: #222; }

        body.dark-mode .tile { background: #2d2d2d; outline-color: #444; }
        body.dark-mode .tile.room-area { background: #1f1f1f; opacity: 1; }
        body.dark-mode .tile.wall { background: transparent; }
        body.dark-mode .tile.door { background: #5a4b35; box-shadow: inset 0 0 0 2px #8B4513; }
        body.dark-mode .tile.start-pos { background: #4a2b2b; }

        body.dark-mode .room-label-overlay { color: #aaa; text-shadow: 2px 2px 0px #000; opacity: 0.7; }

        body.dark-mode .clue-card { opacity: 0.95; }
        /* ì¹´ë“œëŠ” ë‹¤í¬ëª¨ë“œì—ì„œë„ í°ìƒ‰ ë°°ê²½ ê¸°ë°˜ ë””ìì¸ ìœ ì§€ (ë‚´ìš©ë¬¼ ì‹ë³„ ìœ„í•´), ê¸€ì”¨ë§Œ ê²€ì • ìœ ì§€ */
        body.dark-mode .card-name { color: #111; text-shadow: 0 0 2px white; }

        body.dark-mode .my-hand-area { background: rgba(0,0,0,0.2); border-color: #333; }

        /* ìˆ˜ì²© ì²´í¬ ë°°ê²½ ë‹¤í¬ëª¨ë“œ ë³´ì • */
        body.dark-mode .cell-x { background: rgba(215, 58, 73, 0.2); }
        body.dark-mode .cell-o { background: rgba(45, 164, 78, 0.2); }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
<header>
    <div class="repo-breadcrumb">
        <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" width="30" style="border-radius:50%; opacity:1;">
        <a href="/" class="user-name">game-hub</a>
        <span style="color:var(--text-primary)">/</span>
        <a href="#" class="repo-name">Clue</a>
        <span class="badge">Public</span>
    </div>
    <button class="theme-btn" onclick="Core.toggleTheme()">Dark/Light</button>
</header>

<div id="alert-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:2000;">
    <div class="box" style="width:320px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
        <div class="box-header">ì•Œë¦¼</div>
        <div style="padding: 20px; text-align: center;"><p id="alert-msg-text" style="margin: 0;">ë©”ì‹œì§€</p></div>
        <div style="padding:16px; border-top: 1px solid var(--border-color);">
            <button class="btn-primary" onclick="Core.closeAlert()" style="width: 100%;">í™•ì¸</button>
        </div>
    </div>
</div>
<div id="confirm-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:2100;">
    <div class="box" style="width:320px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
        <div class="box-header">í™•ì¸</div>
        <div style="padding: 20px; text-align: center;"><p id="confirm-msg-text" style="margin: 0; word-break: keep-all;">ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p></div>
        <div style="padding:16px; border-top: 1px solid var(--border-color); display:flex; gap:10px;">
            <button class="btn-primary" onclick="Core.confirmOk()" style="flex:1;">ì˜ˆ</button>
            <button class="btn-default" onclick="Core.closeConfirm()" style="flex:1;">ì•„ë‹ˆì˜¤</button>
        </div>
    </div>
</div>
<div id="login-screen" class="container" style="max-width: 400px; margin-top: 50px;">
    <div class="box">
        <div class="box-header">ê²Œì„ ì…ì¥</div>
        <div style="padding: 20px;">
            <label>ë‹‰ë„¤ì„</label>
            <input type="text" id="nicknameInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" onkeypress="if(event.key==='Enter') Core.login()">
            <button class="btn-primary" onclick="Core.login()" style="width:100%; margin-top:20px;">ì…ì¥í•˜ê¸°</button>
        </div>
    </div>
</div>

<div id="lobby-screen" class="container hidden">
    <div class="box">
        <div class="box-header">ëŒ€ê¸°ì‹¤ <span id="welcome-msg" style="font-size:12px; font-weight:normal;"></span></div>
        <div style="padding: 16px; display:flex; gap:10px;">
            <input type="text" id="roomNameInput" placeholder="ë°© ì œëª©" value="ì¶”ë¦¬ í•œ íŒ?" style="flex:2;">
            <div id="game-options-area"></div>
            <button class="btn-primary" onclick="Core.createRoom()">ë°© ë§Œë“¤ê¸°</button>
        </div>
        <div style="max-height: 400px; overflow-y: auto;">
            <div style="padding: 10px 16px; background:var(--bg-header); border-bottom:1px solid var(--border-color); display:flex; justify-content:space-between;">
                <span>ë°© ëª©ë¡</span>
                <button class="btn-default" onclick="Core.loadRooms()" style="font-size:12px;">ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <ul id="room-list" style="list-style: none; padding: 0; margin: 0;"></ul>
        </div>
    </div>
</div>

<div id="game-screen" class="container hidden">
    <div class="game-meta" style="display:flex; justify-content:space-between; margin-bottom:10px; align-items:center;">
        <div>
            <strong id="room-title-text" style="font-size: 18px; color: var(--text-primary);">ë°© ì œëª©</strong>
            <span id="game-status" class="badge">ëŒ€ê¸° ì¤‘</span>
            <span id="my-turn-badge" class="badge" style="background:#d73a49; color:white; display:none;">YOUR TURN</span>
        </div>
        <div>
            <button id="startBtn" class="btn-primary" onclick="ClueGame.startGame()">ê²Œì„ ì‹œì‘</button>
            <button class="btn-danger" onclick="Core.exitRoom()">ë‚˜ê°€ê¸°</button>
        </div>
    </div>

    <div id="game-tools-area" style="margin-bottom:10px; display:flex; gap:10px; align-items:center;">
        <div id="dice-display" style="font-weight:bold; font-size:14px; margin-right:5px; color:var(--text-primary);">ğŸ²: -</div>
        <button id="btn-secret" class="btn-primary" onclick="ClueGame.useSecretPassage()" style="display:none; background-color: #6f42c1; border-color: #6f42c1;">
            <i class="fas fa-dungeon"></i> ë¹„ë°€í†µë¡œ
        </button>
        <button id="btn-roll" class="btn-primary" onclick="ClueGame.rollDice()" disabled>ğŸ² êµ´ë¦¬ê¸°</button>
        <button id="btn-suggest" class="btn-default" onclick="ClueGame.openSuggestModal()" disabled><i class="fas fa-search"></i> ì¶”ë¦¬</button>
        <button id="btn-accuse" class="btn-danger" onclick="ClueGame.openAccuseModal()" disabled><i class="fas fa-gavel"></i> ê³ ë°œ</button>
        <button id="btn-endturn" class="btn-default" onclick="ClueGame.endTurn()" disabled>í„´ ì¢…ë£Œ</button>
        <button id="btn-notebook" class="btn-default" onclick="ClueGame.toggleNotebook()">
            <i class="fas fa-book"></i> ìˆ˜ì²©
        </button>
    </div>

    <div class="game-layout">
        <div id="game-stage" class="game-stage">
            <div id="board-grid" class="clue-board-grid"></div>
            <div class="my-hand-area" id="my-hand-area">
                <div style="width:100%; text-align:center; color:#ccc; font-size:13px;">
                    ê²Œì„ì´ ì‹œì‘ë˜ë©´ ì¹´ë“œê°€ í‘œì‹œë©ë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div id="log-container" class="panel-box">
                <div class="panel-header">ğŸ“œ ê²Œì„ ë¡œê·¸</div>
                <div id="game-logs" class="scroll-content"></div>
            </div>
            <div id="chat-container" class="panel-box">
                <div class="panel-header">ğŸ’¬ ì±„íŒ…</div>
                <div id="messages" class="scroll-content"></div>
                <div class="chat-input-area">
                    <input type="text" id="chatInput" placeholder="ì…ë ¥..." onkeypress="if(event.key==='Enter') Core.sendChat()">
                    <button class="btn-primary" onclick="Core.sendChat()">ì „ì†¡</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="action-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:1500;">
    <div class="box" style="width:320px;">
        <div class="box-header" id="action-modal-title">í–‰ë™</div>
        <div class="modal-body">
            <div class="select-group">
                <label>ë²”ì¸ (Suspect)</label>
                <select id="sel-suspect"></select>
            </div>
            <div class="select-group">
                <label>í‰ê¸° (Weapon)</label>
                <select id="sel-weapon"></select>
            </div>
            <div class="select-group">
                <label>ì¥ì†Œ (Room)</label>
                <select id="sel-room"></select>
            </div>
            <button onclick="ClueGame.submitAction()" class="btn-primary" style="width:100%;">í™•ì¸</button>
            <button class="btn-default" onclick="document.getElementById('action-modal').classList.add('hidden')" style="width:100%; margin-top:5px;">ì·¨ì†Œ</button>
        </div>
    </div>
</div>

<div id="refute-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center; z-index:1600;">
    <div class="box" style="width:400px; border:2px solid #d73a49;">
        <div class="box-header" style="background:#d73a49; color:white;">ğŸš¨ ë°˜ë°•í•˜ê¸°</div>
        <div class="modal-body" style="text-align:center;">
            <p id="refute-msg" style="font-weight:bold; margin-bottom:10px;">ì¶”ë¦¬ ë‚´ìš©</p>
            <p style="font-size:12px; color:#ccc;">ë³´ìœ í•œ ì¹´ë“œ ì¤‘ ë³´ì—¬ì¤„ ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
            <div id="refute-card-list" style="display:flex; justify-content:center; gap:10px; margin:15px 0;"></div>
        </div>
    </div>
</div>
<div id="result-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; justify-content:center; align-items:center; z-index:1700;">
    <div class="box" style="width:300px; text-align:center; animation: popIn 0.3s ease-out;">
        <div class="box-header" style="background:#2b2b2b; color:#fff;">ì¦ê±° í™•ì¸</div>
        <div class="modal-body" style="display:flex; flex-direction:column; align-items:center; gap:15px; padding:25px;">
            <p id="result-msg" style="font-size:14px; margin:0; color:var(--text-primary);">
            </p>

            <div id="revealed-card-area" style="transform: scale(1.2);"></div>

            <button class="btn-primary" onclick="document.getElementById('result-modal').classList.add('hidden')" style="width:100%;">
                í™•ì¸
            </button>
        </div>
    </div>
</div>
<div id="notebook-panel" class="hidden notebook-panel-style">
    <div class="box-header" style="cursor:move;">
        <span>ğŸ•µï¸ íƒì • ìˆ˜ì²©</span>
        <button onclick="ClueGame.toggleNotebook()" class="close-btn">âœ–</button>
    </div>
    <div class="notebook-body">
        <table id="notebook-table">
            <thead id="notebook-head"></thead>
            <tbody id="notebook-body"></tbody>
        </table>
    </div>
    <div class="notebook-footer">
        <button class="btn-default" onclick="ClueGame.resetNotebook()" style="width:100%; font-size:11px;">ì´ˆê¸°í™”</button>
    </div>
</div>
<div id="ranking-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); display:flex; justify-content:center; align-items:center; z-index:2200;">
    <div class="box" style="width:320px; text-align:center; border: 2px solid #ffd700; box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);">
        <div class="box-header" style="background:#ffd700; color:#000; justify-content:center;">
            ğŸ† GAME OVER ğŸ†
        </div>
        <div class="modal-body" style="padding: 30px 20px;">
            <div style="font-size: 50px; margin-bottom: 10px;">ğŸ‰</div>
            <h2 id="winnerName" style="color:var(--text-primary); margin: 10px 0;"></h2>
            <p style="color:#888; font-size:13px;">ìŠ¹ë¦¬ë¥¼ ì¶•í•˜í•©ë‹ˆë‹¤!</p>

            <button class="btn-primary" onclick="Core.closeRanking()" style="width:100%; margin-top:25px; background:#ffd700; color:#000; border:none; font-weight:bold;">
                ë‚˜ê°€ê¸°
            </button>
        </div>
    </div>
</div>
<script src="/Clue/js/game-core.js"></script>
<script src="/Clue/js/clue.js"></script>

</body>
</html>