<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Clue Game</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="https://cdn.simpleicons.org/github/ffffff" type="image/svg+xml">

    <style>
        .hidden { display: none !important; }

        .game-layout {
            display: flex;
            gap: 20px;
            width: 100%;
            height: auto;
            min-height: 850px;
            padding-bottom: 20px;
        }

        .game-stage {
            /* 22ì¹¸ì— ë§ì¶° ë„ˆë¹„ ì¡°ì • */
            flex: 0 0 600px;
            border: 1px solid var(--border-color);
            background: #2b2b2b;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        /* 22x22 ë¦¬ì–¼ ê²©ì ìŠ¤íƒ€ì¼ */
        .clue-board-grid {
            display: grid;
            grid-template-columns: repeat(22, 1fr);
            grid-template-rows: repeat(22, 1fr);
            gap: 0;
            aspect-ratio: 1 / 1; /* ì •ì‚¬ê°í˜• ë¹„ìœ¨ */
            width: 100%;
            max-width: 560px;
            background: #3a3a3a;
            border: 8px solid #4a3b2a;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            box-sizing: content-box;
        }

        .tile {
            position: relative;
            background: #e3c099;
            outline: 1px solid rgba(0,0,0,0.05);
            cursor: pointer;
            aspect-ratio: 1 / 1;
            /* ì•„ì´ì½˜ ì •ë ¬ìš© */
            display: flex; justify-content: center; align-items: center;
        }
        .tile:hover { filter: brightness(0.9); z-index: 2; outline: 1px solid #0969da; }

        .tile.wall {
            background: transparent;
            pointer-events: none;
            outline: none;
        }

        .tile.room-area {
            background-color: #f4f4f4;
            opacity: 0.95;
            outline: none;
            cursor: default;
        }

        /* [ìˆ˜ì •] ë¬¸ ìŠ¤íƒ€ì¼ ê°•í™” */
        .tile.door {
            background: #e3c099;
            box-shadow: inset 0 0 0 2px #b8860b;
            z-index: 1;
        }
        /* ë¬¸ ë‚´ë¶€ ì•„ì´ì½˜/í™”ì‚´í‘œ í¬ê¸° í‚¤ì›€ (JSì—ì„œ ë Œë”ë§ë¨) */
        .tile.door i {
            font-weight: 900; /* ì•„ì´ì½˜ êµµê²Œ */
        }

        /* ì‹œì‘ ì§€ì  */
        .tile.start-pos {
            background: #ffcccc;
            box-shadow: inset 0 0 5px rgba(255,0,0,0.2);
        }

        .right-panel {
            flex: 1;
            display: flex; flex-direction: column; gap: 10px;
            min-width: 300px;
            max-height: 800px;
        }

        .panel-box {
            flex: 1;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--box-bg);
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            padding: 10px 15px;
            background: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            font-size: 14px; font-weight: 600;
            color: var(--text-primary);
        }

        .scroll-content {
            flex: 1; overflow-y: auto; padding: 12px;
            font-size: 13px; color: var(--text-primary);
            line-height: 1.5;
        }

        #game-logs { background: rgba(0,0,0,0.02); }
        .log-item { margin-bottom: 8px; border-bottom: 1px dashed var(--border-color); padding-bottom: 4px; }

        .chat-input-area {
            padding: 10px; border-top: 1px solid var(--border-color);
            display: flex; gap: 8px; align-items: center;
            background: var(--bg-header);
        }
        .chat-input-area input { flex: 1; width: auto; min-width: 0; padding: 6px; }
        .chat-input-area button { flex-shrink: 0; width: auto; }

        .token {
            width: 70%; height: 70%;
            border-radius: 50%;
            border: 2px solid white;
            position: absolute; top: 15%; left: 15%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 10px;
            z-index: 10;
            box-shadow: 1px 2px 4px rgba(0,0,0,0.6);
        }

        /* [ìˆ˜ì •] ë°© ì´ë¦„ ë¼ë²¨ í¬ê¸° í™•ëŒ€ */
        .room-label-overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            white-space: nowrap;
            font-weight: 800;
            font-size: 18px; /* 14px -> 18px */
            color: #222;
            text-transform: uppercase;
            /* ê¸€ì í…Œë‘ë¦¬ë¥¼ ì¤˜ì„œ ê°€ë…ì„± í™•ë³´ */
            text-shadow:
                    -1px -1px 0 #fff,
                    1px -1px 0 #fff,
                    -1px  1px 0 #fff,
                    1px  1px 0 #fff;
            pointer-events: none; z-index: 5;
            opacity: 0.8; /* ì¢€ ë” ì„ ëª…í•˜ê²Œ */
        }

        .my-hand-area {
            width: 95%;
            height: 130px;
            margin-top: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 10px;
            display: flex; gap: 8px;
            overflow-x: auto; align-items: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .clue-card {
            min-width: 75px; height: 110px;
            background: linear-gradient(135deg, #fff 0%, #f9f9f9 100%);
            border: 1px solid #bbb; border-radius: 5px;
            display: flex; flex-direction: column; justify-content: space-between;
            align-items: center;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            padding: 5px; user-select: none; transition: transform 0.2s;
            color: #222;
            flex-shrink: 0;
        }
        .clue-card:hover { transform: translateY(-5px); z-index: 10; }
        .clue-card.suspect { border-top: 4px solid #d73a49; }
        .clue-card.weapon { border-top: 4px solid #6c757d; }
        .clue-card.room { border-top: 4px solid #d29922; }
        .card-icon { font-size: 26px; margin: 4px 0; }
        .card-name { font-weight: bold; font-size: 11px; text-align: center; }
        .card-type { font-size: 9px; color: #666; text-transform: uppercase; }

        .modal-body { padding: 20px; }
        .select-group { margin-bottom: 15px; }
        .select-group label { display: block; font-weight: bold; margin-bottom: 6px; font-size: 13px; color: var(--text-primary); }
        .select-group select { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); }

        body.dark-mode .game-stage { background: #1a1a1a; border-color: #333; }
        body.dark-mode .clue-board-grid { background: #111; border-color: #222; }
        body.dark-mode .tile { background: #2d2d2d; outline-color: #444; }
        body.dark-mode .tile.room-area { background: #1f1f1f; opacity: 1; }
        body.dark-mode .tile.wall { background: transparent; }
        body.dark-mode .tile.door { background: #5a4b35; box-shadow: inset 0 0 0 2px #8B4513; }
        body.dark-mode .tile.start-pos { background: #4a2b2b; }
        body.dark-mode .room-label-overlay { color: #aaa; text-shadow: 2px 2px 0px #000; opacity: 0.7; }
        body.dark-mode .clue-card { background: #161b22 !important; border-color: #30363d; color: #c9d1d9; }
        body.dark-mode .card-type { color: #8b949e; }
        body.dark-mode .my-hand-area { background: rgba(0,0,0,0.2); border-color: #333; }
    </style>
</head>
<body>
<header>
    <div class="repo-breadcrumb">
        <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" width="30" style="border-radius:50%; opacity:1;">
        <a href="/" class="user-name">game-hub</a>
        <span style="color:var(--text-primary)">/</span>
        <a href="#" class="repo-name">Clue</a>
        <span class="badge">Public</span>
    </div>
    <button class="theme-btn" onclick="Core.toggleTheme()">Dark/Light</button>
</header>

<div id="alert-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:2000;">
    <div class="box" style="width:320px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
        <div class="box-header">ì•Œë¦¼</div>
        <div style="padding: 20px; text-align: center;"><p id="alert-msg-text" style="margin: 0;">ë©”ì‹œì§€</p></div>
        <div style="padding:16px; border-top: 1px solid var(--border-color);">
            <button class="btn-primary" onclick="Core.closeAlert()" style="width: 100%;">í™•ì¸</button>
        </div>
    </div>
</div>

<div id="login-screen" class="container" style="max-width: 400px; margin-top: 50px;">
    <div class="box">
        <div class="box-header">ê²Œì„ ì…ì¥</div>
        <div style="padding: 20px;">
            <label>ë‹‰ë„¤ì„</label>
            <input type="text" id="nicknameInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" onkeypress="if(event.key==='Enter') Core.login()">
            <button class="btn-primary" onclick="Core.login()" style="width:100%; margin-top:20px;">ì…ì¥í•˜ê¸°</button>
        </div>
    </div>
</div>

<div id="lobby-screen" class="container hidden">
    <div class="box">
        <div class="box-header">ëŒ€ê¸°ì‹¤ <span id="welcome-msg" style="font-size:12px; font-weight:normal;"></span></div>
        <div style="padding: 16px; display:flex; gap:10px;">
            <input type="text" id="roomNameInput" placeholder="ë°© ì œëª©" value="ì¶”ë¦¬ í•œ íŒ?" style="flex:2;">
            <div id="game-options-area"></div>
            <button class="btn-primary" onclick="Core.createRoom()">ë°© ë§Œë“¤ê¸°</button>
        </div>
        <div style="max-height: 400px; overflow-y: auto;">
            <div style="padding: 10px 16px; background:var(--bg-header); border-bottom:1px solid var(--border-color); display:flex; justify-content:space-between;">
                <span>ë°© ëª©ë¡</span>
                <button class="btn-default" onclick="Core.loadRooms()" style="font-size:12px;">ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <ul id="room-list" style="list-style: none; padding: 0; margin: 0;"></ul>
        </div>
    </div>
</div>

<div id="game-screen" class="container hidden">
    <div class="game-meta" style="display:flex; justify-content:space-between; margin-bottom:10px; align-items:center;">
        <div>
            <strong id="room-title-text" style="font-size: 18px; color: var(--text-primary);">ë°© ì œëª©</strong>
            <span id="game-status" class="badge">ëŒ€ê¸° ì¤‘</span>
            <span id="my-turn-badge" class="badge" style="background:#d73a49; color:white; display:none;">YOUR TURN</span>
        </div>
        <div>
            <button id="startBtn" class="btn-primary" onclick="ClueGame.startGame()">ê²Œì„ ì‹œì‘</button>
            <button class="btn-danger" onclick="Core.exitRoom()">ë‚˜ê°€ê¸°</button>
        </div>
    </div>

    <div id="game-tools-area" style="margin-bottom:10px; display:flex; gap:10px; align-items:center;">
        <div id="dice-display" style="font-weight:bold; font-size:14px; margin-right:5px; color:var(--text-primary);">ğŸ²: -</div>
        <button id="btn-roll" class="btn-primary" onclick="ClueGame.rollDice()" disabled>ğŸ² êµ´ë¦¬ê¸°</button>
        <button id="btn-suggest" class="btn-default" onclick="ClueGame.openSuggestModal()" disabled><i class="fas fa-search"></i> ì¶”ë¦¬</button>
        <button id="btn-accuse" class="btn-danger" onclick="ClueGame.openAccuseModal()" disabled><i class="fas fa-gavel"></i> ê³ ë°œ</button>
        <button id="btn-endturn" class="btn-default" onclick="ClueGame.endTurn()" disabled>í„´ ì¢…ë£Œ</button>
    </div>

    <div class="game-layout">
        <div id="game-stage" class="game-stage">
            <div id="board-grid" class="clue-board-grid"></div>
            <div class="my-hand-area" id="my-hand-area">
                <div style="width:100%; text-align:center; color:#ccc; font-size:13px;">
                    ê²Œì„ì´ ì‹œì‘ë˜ë©´ ì¹´ë“œê°€ í‘œì‹œë©ë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div id="log-container" class="panel-box">
                <div class="panel-header">ğŸ“œ ê²Œì„ ë¡œê·¸</div>
                <div id="game-logs" class="scroll-content"></div>
            </div>
            <div id="chat-container" class="panel-box">
                <div class="panel-header">ğŸ’¬ ì±„íŒ…</div>
                <div id="messages" class="scroll-content"></div>
                <div class="chat-input-area">
                    <input type="text" id="chatInput" placeholder="ì…ë ¥..." onkeypress="if(event.key==='Enter') Core.sendChat()">
                    <button class="btn-primary" onclick="Core.sendChat()">ì „ì†¡</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="action-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:1500;">
    <div class="box" style="width:320px;">
        <div class="box-header" id="action-modal-title">í–‰ë™</div>
        <div class="modal-body">
            <div class="select-group">
                <label>ë²”ì¸ (Suspect)</label>
                <select id="sel-suspect"></select>
            </div>
            <div class="select-group">
                <label>í‰ê¸° (Weapon)</label>
                <select id="sel-weapon"></select>
            </div>
            <div class="select-group">
                <label>ì¥ì†Œ (Room)</label>
                <select id="sel-room"></select>
            </div>
            <button onclick="ClueGame.submitAction()" class="btn-primary" style="width:100%;">í™•ì¸</button>
            <button class="btn-default" onclick="document.getElementById('action-modal').classList.add('hidden')" style="width:100%; margin-top:5px;">ì·¨ì†Œ</button>
        </div>
    </div>
</div>

<div id="refute-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center; z-index:1600;">
    <div class="box" style="width:400px; border:2px solid #d73a49;">
        <div class="box-header" style="background:#d73a49; color:white;">ğŸš¨ ë°˜ë°•í•˜ê¸°</div>
        <div class="modal-body" style="text-align:center;">
            <p id="refute-msg" style="font-weight:bold; margin-bottom:10px;">ì¶”ë¦¬ ë‚´ìš©</p>
            <p style="font-size:12px; color:#ccc;">ë³´ìœ í•œ ì¹´ë“œ ì¤‘ ë³´ì—¬ì¤„ ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
            <div id="refute-card-list" style="display:flex; justify-content:center; gap:10px; margin:15px 0;"></div>
        </div>
    </div>
</div>

<script src="/Clue/js/game-core.js"></script>
<script src="/Clue/js/clue.js"></script>

</body>
</html>